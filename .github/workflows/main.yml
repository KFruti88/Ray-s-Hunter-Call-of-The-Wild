name: Sync Trophy Stats
on:
  schedule:
    - cron: '0 * * * *' # Runs once every hour
  workflow_dispatch: # Allows you to run it manually from the Actions tab

permissions:
  contents: write # Required to allow the bot to save changes to your repo

jobs:
  sync-stats:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4 # Downloads your code so the bot can edit it

      - name: Fetch StreamElements Data
        run: |
          # Fetch your spturkey counter value
          # Account ID: 683d5f784b7b70b6bf43aacb
          RESPONSE=$(curl -s "https://api.streamelements.com/static/v2/channels/683d5f784b7b70b6bf43aacb/counters/spturkey")
          
          # Extract the count value using jq
          COUNT=$(echo $RESPONSE | jq -r '.count')
          
          # Update the 'current' value for the 'spturkey' item in your trophies.json
          jq --arg new_val "$COUNT" '(.[] | select(.id == "spturkey") | .current) = ($new_val | tonumber)' trophies.json > temp.json && mv temp.json trophies.json

      - name: Commit and Push Changes
        run: |
          git config --global user.name "GitHub Action Bot"
          git config --global user.email "actions@github.com"
          git add trophies.json
          # Only commit if there is an actual change to the numbers
          git diff --quiet && git diff --staged --quiet || (git commit -m "Automated trophy sync: $(date)" && git push)
